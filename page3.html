<!DOCTYPE html>
<html lang="en">
<head>
  <title>page3</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width" />
  <link rel="stylesheet" href="styles.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>
<body>
  <nav>
    <a href="/" aria-current="page">login</a>
    <a href="/page2.html">dashboard</a>
    <a href="/page3.html" aria-current="page">current</a>
    <a href="/page4.html" aria-current="page">budget</a>
  </nav>
  <main>
    <canvas id="myChart1" width="400" height="400"></canvas>
    <p>Please enter your monthly income as your first data point</p>
    <div class="mt-3">
      <label for="newDataInput">Add Data:</label>
      <input type="number" id="newDataInput"/>
      <select id="colorSelect">
        <option value="#9FDDFF">Light Blue</option>
        <option value="#A5FF9D">Light Green</option>
        <option value="#C49FFF">Light Purple</option>
        <option value="#FF9D9D">Light Red</option>
        <option value="#FFC09D">Light Orange</option>
        <option value="#FFE49F">Light Yellow</option>
      </select>
      <select id="categorySelect">
        <option value="Rent">Rent</option>
        <option value="Utility">Utility</option>
        <option value="Subscription">Subscription</option>
        <option value="Groceries">Groceries</option>
        <option value="Income">Income</option>
      </select>
      <input type="text" id="descriptionInput" placeholder="Add description">
      <button id="addDataButton" class="btn btn-primary">Add Data</button>
    </div>
    
    <!-- Table to display saved data -->
    <table class="table mt-4">
      <thead>
        <tr>
          <th>Data Value</th>
          <th>Budget</th>
          <th>Description</th>
          <th>Color</th>
          <th>Update</th>
        </tr>
      </thead>
      <tbody id="dataTableBody"></tbody>
    </table>
    <a href="/page2.html" class="btn btn-primary mt-3">Return to Dashboard</a>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      let chartDataWithColors = JSON.parse(localStorage.getItem('chartDataWithColors')) || [];
      displayTable(chartDataWithColors);
  
      let chartData = chartDataWithColors.map(item => item.data);
      let chartColors = chartDataWithColors.map(item => item.color);
  
      let ctx = document.getElementById('myChart1').getContext('2d');
      let chart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: [],
          datasets: [{
            data: chartData,
            backgroundColor: chartColors,
            hoverBackgroundColor: chartColors
          }]
        }
      });
  
      document.getElementById('addDataButton').addEventListener('click', function() {
        let newData = parseInt(document.getElementById('newDataInput').value);
        let category = document.getElementById('categorySelect').value;
        let description = document.getElementById('descriptionInput').value;
        let color = document.getElementById('colorSelect').value;
  
        if (!isNaN(newData) && newData >= 0) {
          let newDataWithColor = { data: newData, color: color, category: category, description: description };
          chartDataWithColors.push(newDataWithColor);
  
          chartData.push(newData);
          chartColors.push(color);
  
          chart.data.datasets[0].data = chartData;
          chart.data.datasets[0].backgroundColor = chartColors;
          chart.data.datasets[0].hoverBackgroundColor = chartColors;
          chart.update();
  
          localStorage.setItem('chartDataWithColors', JSON.stringify(chartDataWithColors));
          displayTable(chartDataWithColors);

          document.getElementById('newDataInput').value = '';
          document.getElementById('descriptionInput').value = '';
        }
      });
  
      function displayTable(dataWithColors) {
  let tableBody = document.getElementById('dataTableBody');
  tableBody.innerHTML = '';

  for (let i = 0; i < dataWithColors.length; i++) {
    let row = document.createElement('tr');

    let valueCell = document.createElement('td');
    valueCell.textContent = dataWithColors[i].data;
    row.appendChild(valueCell);

    let categoryCell = document.createElement('td');
    categoryCell.textContent = dataWithColors[i].category;
    row.appendChild(categoryCell);

    let descriptionCell = document.createElement('td');
    descriptionCell.textContent = dataWithColors[i].description;
    row.appendChild(descriptionCell);

    let colorCell = document.createElement('td');

    let colorSquare = document.createElement('span');
    colorSquare.style.display = 'inline-block';
    colorSquare.style.width = '20px';
    colorSquare.style.height = '20px';
    colorSquare.style.backgroundColor = dataWithColors[i].color;
    colorSquare.style.marginRight = '5px';

    let colorName = document.createElement('span');
    colorName.textContent = getColorName(dataWithColors[i].color);

    colorCell.appendChild(colorSquare);
    colorCell.appendChild(colorName);

    row.appendChild(colorCell);

    let actionsCell = document.createElement('td');
    let editButton = document.createElement('button');
    editButton.textContent = 'Edit';
    editButton.classList.add('btn', 'btn-primary', 'me-2');
    editButton.onclick = function() {
      let updatedValue = prompt('Enter updated value:');
      if (updatedValue !== null) {
        dataWithColors[i].data = parseInt(updatedValue);

        chartData[i] = parseInt(updatedValue);
        chart.data.datasets[0].data = chartData;
        chart.update();

        localStorage.setItem('chartDataWithColors', JSON.stringify(dataWithColors));
        displayTable(dataWithColors);
      }
    };
    actionsCell.appendChild(editButton);

    let deleteButton = document.createElement('button');
    deleteButton.textContent = 'Delete';
    deleteButton.classList.add('btn', 'btn-danger');
    deleteButton.onclick = function() {
      dataWithColors.splice(i, 1);

      chartData.splice(i, 1);
      chartColors.splice(i, 1);

      chart.data.datasets[0].data = chartData;
      chart.data.datasets[0].backgroundColor = chartColors;
      chart.data.datasets[0].hoverBackgroundColor = chartColors;
      chart.update();

      localStorage.setItem('chartDataWithColors', JSON.stringify(dataWithColors));
      displayTable(dataWithColors);
    };
    actionsCell.appendChild(deleteButton);

    row.appendChild(actionsCell);
    tableBody.appendChild(row);
  }
}
  
      function getColorName(hex) {
        switch (hex) {
          case '#9FDDFF':
            return 'Light Blue';
          case '#A5FF9D':
            return 'Light Green';
          case '#C49FFF':
            return 'Light Purple';
          case '#FF9D9D':
            return 'Light Red';
          case '#FFC09D':
            return 'Light Orange';
          case '#FFE49F':
            return 'Light Yellow';
          default:
            return 'Unknown Color';
        }
      }
    });
  </script>
</body>
</html>